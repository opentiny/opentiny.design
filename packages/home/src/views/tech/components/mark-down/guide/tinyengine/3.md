æœ¬æ–‡ç”±ç¾½æ¯›ç¬”è®°ï¼ˆchrome æ’ä»¶ï¼‰ä½œè€…ã€h5vue ä½œè€…**è§‚é»˜**åŸåˆ›ã€‚

> æœ¬æ–‡é€‚åˆå¯¹ä½ä»£ç å¼€å‘æœ‰ä¸€å®šå…´è¶£ï¼Œå¹¶å…·å¤‡ Vue.jsã€Node.js åŠåŸºæœ¬å‘½ä»¤è¡Œæ“ä½œç»éªŒçš„å‰ç«¯å¼€å‘è€…ã€‚

## ä¸€èµ·æ¥æä½ä»£ç --åä¸º TinyEngine ä¸Šæ‰‹æŒ‡å—

åœ¨æ·±åº¦å¼€å‘ã€ä½¿ç”¨ä¸€ä¸ªæœˆä¹‹åï¼Œæˆ‘æƒ³æ¥è·Ÿä½ åˆ†äº«ä¸€ä¸‹è¿™æ¬¾åä¸ºå¼€æºçš„ä½ä»£ç å¼•æ“--TinyEngineã€‚å®ƒåŸºäº Vue3ï¼Œåˆ©ç”¨ DSL å®ç°ä» schema ç”Ÿæˆæºç ï¼Œæ”¯æŒå¤šæ¡†æ¶é›†æˆï¼Œä¸”æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œèƒ½å®ç°å„ç§å®šåˆ¶åŒ–å¼€å‘çš„éœ€æ±‚ã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€æ¬¾è¶æ‰‹çš„ä½ä»£ç å¼•æ“æˆ–è€…ä½ å¯¹ä½ä»£ç å¼€å‘æ„Ÿå…´è¶£ï¼Œé‚£ä½ ä¸å¦¨æ¥è¯•è¯• TinyEngineã€‚æˆ‘ä¼šç”¨è¿™ç¯‡æ–‡ç« æ‰‹æŠŠæ‰‹å¸¦ä½ å®Œæˆé¡¹ç›®æ­å»ºã€ç»„ä»¶åº“éƒ¨ç½²ä¸æ³¨å†Œå¹¶å¼€å‘ä¸€æ¬¾ç®€å•çš„æ’ä»¶ã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/3-1.png)

## å‰ç«¯éƒ¨ç½²

ä» [tiny-engine](https://github.com/opentiny/tiny-engine) æ‹‰å– `develop` åˆ†æ”¯å¹¶å®‰è£…ä¾èµ–åå°±å¯ä»¥ç›´æ¥å¼€å¯æœ¬é¡¹ç›®ï¼š

```bash
git clone git@github.com:opentiny/tiny-engine.git -b develop
pnpm i
pnpm dev
```

æ˜¯çš„ï¼Œå°±è·Ÿå…¶ä»–é¡¹ç›®ä¸€æ ·ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—® `localhost:8090` æ¥åˆæ­¥ä½“éªŒäº†ã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/3-2.gif)

åœ¨åˆæ­¥ä½“éªŒä¹‹åï¼Œå‘ç°å‡ºç åçš„é¡¹ç›®æ— æ³•æˆåŠŸå®‰è£…ä¾èµ–ï¼Œè¿™æ˜¯å› ä¸º dev å…¶å®å¯åŠ¨äº†ä¸€ä¸ª mock server åšä¸ºæœåŠ¡ç«¯ï¼Œä½†æ˜¯è¿™ä¸ª mock server å·²ç»è½åäºç‰ˆæœ¬éœ€æ±‚äº†ï¼ˆæˆªæ­¢åˆ° v2.3ï¼‰ã€‚

æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸‹ä¸€ä¸ªç¯èŠ‚ã€‚

## åç«¯éƒ¨ç½²

åŒæ ·ä» [tiny-engine-backend-java](https://github.com/opentiny/tiny-engine-backend-java) éƒ¨ç½²æ‹‰å– `develop` åˆ†æ”¯å¹¶å®‰è£…ä¾èµ–åå°±å¯ä»¥ç›´æ¥å¼€å¯æœ¬é¡¹ç›®ï¼Œå…·ä½“æ­¥éª¤è¯·å‚è€ƒ[å®˜æ–¹è¯´æ˜](https://opentiny.design/tiny-engine#/help-center/course/dev/1201)

å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®ä¿¡æ¯ï¼š`app/src/main/resources/application-dev.yml`ï¼š

```yml
server:
  address: 0.0.0.0
  port: 7090

spring:
  # æ•°æ®åº“ä¿¡æ¯
  datasource:
    username: xxx
    password: xxx
    url: xxx
```

å¯åŠ¨åç«¯æœåŠ¡åï¼Œæˆ‘ä»¬éœ€è¦åŒæ­¥è°ƒæ•´ tiny-engine é¡¹ç›®ä¸­çš„ä»¥ä¸‹é…ç½®ï¼š

1. `designer-demo/engine.config.js` ä¸­çš„`material`å±æ€§å¢åŠ åŸŸåä¿¡æ¯ï¼š <http://localhost:8090/mock/bundle.json> ï¼ˆè¿™é‡Œçš„åŸŸååº”è¯¥æ˜¯ tiny-engine çš„åœ°å€ï¼Œä¸æ˜¯åç«¯æœåŠ¡åœ°å€ï¼‰
2. `tiny-engine/designer-demo/env/.env.development` ä¸­`VITE_ORIGIN` è®¾ç½®ä¸ºåˆšåˆšéƒ¨ç½²çš„åç«¯æœåŠ¡åœ°å€ï¼š`VITE_ORIGIN=http://127.0.0.1:7090`

ç»è¿‡ä»¥ä¸Šé…ç½®çš„è°ƒæ•´ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥é€šè¿‡ `pnpm serve:frontend` å¯åŠ¨é¡¹ç›®äº†ã€‚

ç»è¿‡æµ‹è¯•ï¼Œå‡ºç åçš„é¡¹ç›®å¯ä»¥æ­£å¸¸å®‰è£…ä¾èµ–&è¿è¡Œã€‚

## ç»„ä»¶åº“æ­å»ºä¸å‘å¸ƒ

#### ç»„ä»¶åº“

å¦‚æœä½ æ²¡æœ‰ç°æˆçš„ç»„ä»¶åº“ï¼Œä½ å¯ä»¥è€ƒè™‘ç”¨æˆ‘å‘å¸ƒåˆ°è¿™ä¸ªç»„ä»¶åº“é¡¹ç›®æ¨¡æ¿ [component-library-thin](https://github.com/Ljhhhhhh/component-library-thin) ã€‚

```bash
git clone git@github.com:Ljhhhhhh/component-library-thin.git
```

#### verdaccio

ç»„ä»¶åº“å¯ä»¥å‘å¸ƒåˆ°å…¬ç½‘çš„`npm`ï¼Œä¸è¿‡æˆ‘éœ€è¦ç”¨ç§æœ‰ä»“åº“ï¼Œæ‰€ä»¥å°±é€‰æ‹© [verdaccio](https://verdaccio.org/zh-cn/)ã€‚æŒ‰ç…§å®˜æ–¹è¯´æ˜è¿›è¡Œå®‰è£…å¹¶å¼€å¯æœåŠ¡ï¼š

```bash
npm install -g verdaccio
verdaccio
```

å¼€å¯æœåŠ¡åæ³¨æ„ä¸€ä¸‹ç»™å‡ºçš„é…ç½®åœ°å€(`/path/to/config.yaml`)ï¼Œå¢åŠ è¿™æ¡é…ç½®ï¼š`listen: 0.0.0.0:4873`ï¼Œä½¿ä»–å¯ä»¥é€šè¿‡å¤šç§åœ°å€è¿›è¡Œè®¿é—®ã€‚

ä¿®æ”¹å®Œæˆåï¼Œé‡å¯æœåŠ¡ã€‚

#### å‘å¸ƒç»„ä»¶åº“

é€šè¿‡ verdaccio æ­å»ºç§æœ‰ä»“åº“åï¼Œæˆ‘ä»¬å›åˆ°ç»„ä»¶åº“é¡¹ç›®å¹¶æŒ‰å®é™…æƒ…å†µæ¥é…ç½®ç»„ä»¶åº“ä¸­çš„ `publishConfig` ä¿¡æ¯ï¼š

```json
"publishConfig": {
    "registry": "http://localhost:4873"
}
```

éšåå°±æ˜¯æ‰“åŒ…ã€æ·»åŠ è´¦å·å¹¶å‘å¸ƒï¼š

```bash
npm build
npm adduser --registry http://localhost:4873/
npm publish
```

å‘å¸ƒå®Œæˆåæˆ‘ä»¬è®¿é—® <http://localhost:4873/> å¯ä»¥çœ‹åˆ°å·²ç»æœ‰äº†åˆšåˆšå‘å¸ƒçš„ç»„ä»¶ä¿¡æ¯ã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/3-3.png)

## ç»„ä»¶èµ„æºæœåŠ¡

> å¦‚æœä½ æ˜¯æŠŠç»„ä»¶åº“éƒ¨ç½²åˆ°äº†å…¬å…±çš„`npm`ä¸Šï¼Œå¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†å†…å®¹ï¼Œç»„ä»¶èµ„æºå¯ä»¥ç›´æ¥é€šè¿‡ [unpkg](https://unpkg.com/)è·å–

åœ¨ tinyEngine ä¸­ï¼Œæƒ³è¦æ³¨å†Œç¬¬ä¸‰æ–¹ç»„ä»¶åº“åšä¸ºç‰©æ–™éœ€è¦é€šè¿‡èµ„æºæœåŠ¡çš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨è‡ªå·±éƒ¨ç½²`unpkg`çš„æ–¹å¼æ¥æä¾›èµ„æºæœåŠ¡ã€‚

è¿™é‡Œæ¨è [lzwme çš„ unpkg](git@github.com:lzwme/unpkg.git)ï¼Œå› ä¸ºå®˜æ–¹çš„ unpkg éœ€è¦æ­é…`CLOUDFLARE`ï¼Œæ­¤é¡¹ç›®å·²ç»åšäº†ä¸€äº›é€‚é…å›½å†…ç½‘ç»œçš„å·¥ä½œï¼Œå¯ä»¥å‡å°‘ä¸€äº›å¿ƒæ™ºè´Ÿæ‹…ã€‚

åœ¨ clone æ­¤é¡¹ç›®åï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µå†™å…¥é…ç½®ï¼š

```bash
# verdaccio æœåŠ¡åœ°å€
NPM_REGISTRY_URL=http://127.0.0.1:4873

# unpkg éƒ¨ç½²ä¿¡æ¯
ORIGIN=http://127.0.0.1
PORT=4874
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥å®‰è£…ä¾èµ–å¹¶é€šè¿‡`pnpm serve` æ¥å¯åŠ¨`unpkg`æœåŠ¡äº†ã€‚
å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡è®¿é—®`http://127.0.0.1:4874/:package`è·å–åˆ°ç»„ä»¶çš„é™æ€èµ„æºã€‚

> é™æ€èµ„æºçš„åœ°å€å¯ä»¥ä¿å­˜ä¸€ä¸‹ï¼Œä¸‹ä¸€æ­¥å°±ä¼šç”¨åˆ°

## å¦‚ä½•æ³¨å†Œç»„ä»¶åˆ° TinyEngine

å‘å¸ƒäº†ç»„ä»¶åº“ï¼Œä¹Ÿæä¾›äº†é™æ€èµ„æºæœåŠ¡ï¼Œç°åœ¨å°±å¯ä»¥åœ¨ TinyEngine ä¸­æ¶ˆè´¹æˆ‘ä»¬çš„ç»„ä»¶äº†ã€‚
ä¸è¿‡åˆ«æ€¥ï¼Œè¿˜éœ€è¦ä½ è·Ÿç€æˆ‘ä¸€æ­¥ä¸€æ­¥æ“ä½œï¼š

**ç¬¬ä¸€æ­¥ï¼š**
åŸºäº mock ä¸‹çš„ bundle.json æ‹†åˆ†ç»„ä»¶ï¼š`pnpm splitMaterials`ï¼Œæ‰§è¡Œæ­¤æŒ‡ä»¤ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸¤éƒ¨åˆ†ç‰©æ–™é…ç½®æ–‡ä»¶ï¼š

1. materials/packages.json è¿™ä¸ªæ˜¯ä¾èµ–åŒ…çš„ä¿¡æ¯
2. materials/components/\*\*.json è¿™é‡Œå­˜æ”¾ç€æ‰€æœ‰ç»„ä»¶çš„ schema

**ç¬¬äºŒæ­¥ï¼š**
è¿½åŠ éœ€è¦æ³¨å†Œçš„ç»„ä»¶åº“ä¿¡æ¯åˆ° `materials/packages.json`çš„ packages æ•°ç»„ï¼Œå¦‚ï¼š

```json
{
  "name": "æˆ‘çš„ç»„ä»¶åº“",
  "package": "@dcp/component-library", // ç»„ä»¶åº“åŒ…å
  "version": "0.0.1",
  "script": "http://127.0.0.1:4874/@dcp/component-library@0.0.1/js/component-library.mjs", // ä¸Šä¸€æ­¥å¾—åˆ°çš„ç»„ä»¶é™æ€èµ„æºåœ°å€
  "destructuring": true, // å¼•å…¥æ–¹å¼ï¼Œtrue=å˜é‡å¼•å…¥ï¼Œfalse=default å¼•å…¥
  "npmrc": "@dcp:registry=http://127.0.0.1:4873" // éœ€è¦è¿½åŠ åˆ° npmrc çš„é•œåƒä¿¡æ¯
}
```

**ç¬¬ä¸‰æ­¥ï¼š**
æ ¹æ®[ç‰©æ–™åè®®](https://opentiny.design/tiny-engine#/protocol)æ·»åŠ ç»„ä»¶ schemaï¼ˆcomponent.jsonï¼‰ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ºæ¯”è¾ƒé‡è¦çš„ä¸€äº›é…ç½®ï¼š

```json
{
  "component": "MainMenuButton",
  "icon": "button",
  "npm": {
    "package": "@dcp/component-library",
    "exportName": "MainMenuButton",
    "version": "0.0.1",
    "script": "http://127.0.0.1:4874/@dcp/component-library@0.0.1/js/component-library.mjs",
    "destructuring": true,
    "npmrc": "@dcp:registry=http://127.0.0.1:4873"
  },
  "group": "customer",
  "category": "button",
  "schema": {
    "properties": {}, // ç»„ä»¶çš„ props ä¿¡æ¯
    "events": {}, // ç»„ä»¶æä¾›çš„äº‹ä»¶
    "slots": {} // ç»„ä»¶çš„æ’æ§½ä¿¡æ¯
  },
  "snippets": {} // ç»„ä»¶é¢æ¿é…ç½®
}
```

ç»„ä»¶é…ç½®ä¿¡æ¯è¿˜æ˜¯æŒºå¤šçš„ï¼Œæ¨èå‚è€ƒå·²æœ‰çš„ç»„ä»¶ schema è¿›è¡Œå­¦ä¹ éªŒè¯ã€‚
å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åº”ç”¨ AI å¸®æˆ‘ä»¬ç”Ÿæˆç»„ä»¶ schemaï¼Œæˆ‘åœ¨é™„å½•ä¸­æä¾›äº†ä¸€æ¡ promptï¼Œç»è¿‡æˆ‘çš„å¤šæ¬¡ä¼˜åŒ–ï¼Œä½¿ç”¨æ•ˆæœè¿˜ä¸é”™ã€‚

**ç¬¬å››æ­¥ï¼š**
æŒ‰ç…§æ•°æ®åº“é…ç½®æ›´æ–°æ ¹ç›®å½•ä¸‹`.env.local`é…ç½®ï¼š

    SQL_HOST=127.0.0.1
    SQL_PORT=3306
    SQL_USER=root
    SQL_PASSWORD=12345678
    SQL_DATABASE=tiny_engine_data_java

**ç¬¬äº”æ­¥ï¼š**
æ‰§è¡ŒæŒ‡ä»¤ï¼š`pnpm buildMaterials`

å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œdesigner-demo/public/mock/bundle.json ä¸‹çš„é…ç½®å’Œæ•°æ®åº“çš„ t_components è¡¨ä¸­ä¼šæ’å…¥æ–°å¢çš„ç»„ä»¶ä¿¡æ¯ã€‚
ç°åœ¨åˆ°éªŒæ”¶æˆæœçš„æ—¶å€™äº†ã€‚

æ‰§è¡ŒæŒ‡ä»¤ï¼š`pnpm run serve:frontend` å¹¶è®¿é—®ï¼š<http://127.0.0.1:8090/?type=app&id=1&tenant=1&pageid=1>

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç»„ä»¶å·²ç»å¯ç”¨ï¼š

![å›¾ç‰‡](../../image/guide-tinyengine/3-4.gif)

ä½†æ˜¯æˆ‘ä»¬å‡ºç åä¼šå‘ç°æ— æ³•å®‰è£…ä¾èµ–ï¼Œå¹¶æç¤ºæ‰¾ä¸åˆ°ç»„ä»¶åº“å¯¹åº”çš„åŒ…åœ°å€ã€‚
è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç§æœ‰åŒ–éƒ¨ç½²çš„ç»„ä»¶åº“è¿˜éœ€è¦æä¾›å¯¹åº”çš„ç§åº“åœ°å€ï¼Œé‚£æˆ‘ä»¬åŠ¨æ‰‹å®ç°ä¸€ä¸ª npmrc æ–‡ä»¶ç”Ÿæˆçš„æ’ä»¶å§ã€‚

## æºç å¼€å‘-å‡ºç ç”Ÿæˆ npmrc æ–‡ä»¶

> å»ºè®®å…ˆä»å®˜ç½‘æ•™ç¨‹äº†è§£æ’ä»¶å¼€å‘ï¼š<https://opentiny.design/tiny-engine#/help-center/course/dev/17>

#### debug æ€è·¯

é€šè¿‡ Vue DevTools å¯ä»¥å®šä½åˆ°`DesignToolbars` ç»„ä»¶
å†æ ¹æ® css ç±»å®šä½åˆ° toolbar-right-content å¯¹åº”çš„ divï¼Œå¯ä»¥çœ‹åˆ°å·¦ä¾§çš„æŒ‰é’®æ˜¯é€šè¿‡éå†`state.rightBar`å¾—åˆ°çš„ã€‚
å¯¹ `DesignToolbars`è¿›è¡Œ debugï¼Œå¯ä»¥çœ‹åˆ° `state.rightBar` æ•°æ®å¦‚ä¸‹ï¼š

```json
[
  ["engine.toolbars.themeSwitch", "engine.toolbars.redoundo", "engine.toolbars.clean"],
  ["engine.toolbars.preview"],
  ["engine.toolbars.generate-code", "engine.toolbars.save"]
]
```

åˆç†çŒœæµ‹ï¼Œå‡ºç å¯¹åº”çš„æ˜¯`engine.toolbars.generate-code`ï¼Œé€šè¿‡å…¨å±€æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨`packages/toolbars`ä¸‹æ‰¾åˆ°`generate-code` è¿™ä¸ªæ’ä»¶

ä» `gererate` å‡½æ•°æ‰¾åˆ°ç”Ÿæˆæ–‡ä»¶å‡½æ•°ï¼š`getPreGenerateInfo`ï¼Œç»§ç»­è¿½æŸ¥æ‰¾åˆ° `generateAppCode`ï¼Œå‘ç°æ­¤å‡½æ•°ä»`engine.service.generateCode` å¾—åˆ°

ç»§ç»­è¿½æŸ¥ï¼Œå‘ç° `generateAppCode` æ ¸å¿ƒä¸º `@opentiny/tiny-engine-dsl-vue` å¯¼å…¥çš„`generateApp`ã€‚
é‚£å°±ç›´æ¥æ‰¾åˆ° `name` ä¸º `@opentiny/tiny-engine-dsl-vue` çš„åŒ…ã€‚

é€šè¿‡`@opentiny/tiny-engine-dsl-vue`ä¸‹çš„`generateApp`æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä¸»è¦æ˜¯è°ƒç”¨å„ç§å†…ç½®çš„æ’ä»¶è¿›è¡Œæ–‡ä»¶çš„ç”Ÿæˆï¼Œæ¯”å¦‚`genDependenciesPlugin`ã€‚

#### å…·ä½“å®ç°

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨¡ä»¿`genDependenciesPlugin`æ¥å†™ä¸€ä¸ª`genNpmrcPlugin`ï¼š

```js
import { mergeOptions } from '../utils/mergeOptions'
import { parseImport } from '@/generator/vue/sfc/parseImport'

const defaultOption = {
  fileName: '.npmrc',
  path: '.'
}

const getComponentsSet = (schema) => {
  const { pageSchema = [], blockSchema = [] } = schema
  let allComponents = []

  pageSchema.forEach((pageItem) => {
    allComponents = allComponents.concat(parseImport(pageItem.children || [])?.components || [])
  })

  blockSchema.forEach((blockItem) => {
    allComponents = allComponents.concat(parseImport(blockItem.children || [])?.components || [])
  })

  return new Set(allComponents)
}

const parseSchema = (schema) => {
  const { componentsMap = [] } = schema
  const resDeps = []
  const componentsSet = getComponentsSet(schema)

  for (const { package: packageName, npmrc, componentName } of componentsMap) {
    if (
      npmrc &&
      packageName &&
      componentsSet.has(componentName) &&
      resDeps.findIndex((item) => item === npmrc) === -1
    ) {
      resDeps.push(npmrc)
    }
  }

  return resDeps
}

function genNpmrcPlugin(options = {}) {
  const realOptions = mergeOptions(defaultOption, options)

  const { path, fileName } = realOptions

  return {
    name: 'tinyEngine-generateCode-plugin-npmrc',
    description: 'add package dependencies to .npmrc',
    /**
     * åˆ†æä¾èµ–ï¼Œå†™å…¥ package.json
     * @param {import('@opentiny/tiny-engine-dsl-vue').IAppSchema} schema
     * @returns
     */
    run(schema) {
      const npmrcInfo = parseSchema(schema)
      const originNpmrcItem = this.getFile(path, fileName)

      // å¦‚æœæ²¡æœ‰ .npmrc æ–‡ä»¶ï¼Œç›´æ¥å†™å…¥
      if (!originNpmrcItem) {
        this.addFile({ fileType: 'npmrc', fileName, path, fileContent: npmrcInfo.join('\n') }, true)
        return
      }

      // å¦‚æœæœ‰ .npmrc æ–‡ä»¶ï¼Œéœ€è¦å…ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿›è¡Œåˆå¹¶å»é‡
      const originNpmrcContent = originNpmrcItem.fileContent
      const newNpmrcContent = [...new Set([...npmrcInfo, ...originNpmrcContent])].join('\n')

      this.addFile({ fileType: 'npmrc', fileName, path, fileContent: newNpmrcContent }, true)
    }
  }
}

export default genNpmrcPlugin
```

å‰©ä¸‹çš„å°±æ˜¯æ³¨å†Œæ­¤æ’ä»¶ï¼Œç„¶å build ä¸€ä¸‹å½“å‰åŒ…ä¹‹åï¼Œå°±å¯ä»¥å»éªŒæ”¶æˆæœäº†ï¼š

![å›¾ç‰‡](../../image/guide-tinyengine/3-5.png)

æˆåŠŸç”Ÿæˆ`.npmrc`ï¼Œä¸”å†…å®¹æ­£ç¡®ï¼Œå¯ä»¥æˆåŠŸå®‰è£…ä¾èµ–ã€‚

## ç»“è¯­

é€šè¿‡è¿™ä¸€è¶Ÿå®è·µæ—…ç¨‹ï¼Œæˆ‘ä»¬ä¸ä»…è®© TinyEngine åœ¨æœ¬åœ°é¡ºåˆ©è¿è¡Œèµ·æ¥ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬äº²æ‰‹æ‰“é€šäº†ä»æ­å»ºç§æœ‰ç»„ä»¶åº“ã€é…ç½®èµ„æºæœåŠ¡ï¼Œåˆ°å°†å…¶æ— ç¼èå…¥ TinyEngine ç‰©æ–™ä½“ç³»ï¼Œä¹ƒè‡³æœ€ç»ˆé€šè¿‡ç¼–å†™æ’ä»¶è§£å†³å®é™…å·¥ç¨‹é—®é¢˜çš„å®Œæ•´é—­ç¯ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡æŠ€æœ¯çš„æ¼”ç»ƒï¼Œæ›´æ˜¯å¯¹ TinyEngine ä½œä¸ºä¸€æ¬¾å¼€æºä½ä»£ç å¼•æ“å…¶å¼ºå¤§æ‰©å±•æ€§å’Œå®šåˆ¶èƒ½åŠ›çš„æ·±åº¦ä½“éªŒã€‚

å¸Œæœ›è¿™ç¯‡æŒ‡å—èƒ½ä¸ºä½ æ­å¼€ TinyEngine çš„é¢çº±ï¼Œè®©ä½ æ„Ÿå—åˆ°å®ƒåœ¨æå‡å¼€å‘æ•ˆç‡ã€åº”å¯¹å¤æ‚åœºæ™¯æ–¹é¢çš„æ½œåŠ›ã€‚æŒæ¡è¿™äº›åŸºç¡€åï¼Œä½ å°†èƒ½æ›´è‡ªä¿¡åœ°å»æ¢ç´¢ TinyEngine æä¾›çš„ä¸°å¯ŒåŠŸèƒ½ï¼Œæ„å»ºæ›´å¤æ‚çš„ä½ä»£ç åº”ç”¨ï¼Œç”šè‡³ä¸ºè¿™ä¸ªå……æ»¡æ´»åŠ›çš„å¼€æºç¤¾åŒºè´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›é‡ã€‚ä½ä»£ç çš„ä¸–ç•Œå¹¿é˜”ï¼Œè€Œ TinyEngine æ— ç–‘æ˜¯å…¶ä¸­å€¼å¾—ä½ æ·±å…¥æ¢ç´¢çš„åˆ©å™¨ã€‚

## é™„å½•

#### ç»„ä»¶ schema ç”Ÿæˆ prompt

    ç»™ Vue ç»„ä»¶ç”Ÿæˆç¬¦åˆ OpenTiny è§„èŒƒçš„ç»„ä»¶ Schemaï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯¦ç»†æ­¥éª¤æ‰§è¡Œ:

    # é¢„ä¹ 

    é€šè¿‡äº†è§£ @componentSchema/TinyButton.json @componentSchema/TinyCheckbox.json çš„æ•°æ®ï¼Œäº†è§£ç»„ä»¶çš„ schema æ ¼å¼è§„èŒƒ

    # ç¬¬ä¸€æ­¥ï¼šå…¨å±€ä¿¡æ¯æå–

    1. ç»„ä»¶åŸºæœ¬ä¿¡æ¯

       - id: 1
       - version: ä» package.json ä¸­æå–
       - component: ä» defineComponent çš„ name å±æ€§æå–ç»„ä»¶åç§°
       - æ ¹æ®ç»„ä»¶åŠŸèƒ½ï¼Œç”Ÿæˆç¬¦åˆè§„èŒƒçš„ä¸­æ–‡åç§°åŠæè¿°
       - æ ¹æ®ç»„ä»¶ç±»å‹ï¼Œé€‰æ‹©é€‚å½“çš„ icon & group & category

    2. é…ç½® npm ç›¸å…³ä¿¡æ¯

       - package: ä» package.json ä¸­æå– name
       - exportName: ä½¿ç”¨ç»„ä»¶å
       - version: ä» package.json ä¸­æå– version
       - script: http://localhost:4874/@dcp/component-library@0.0.1/dist/componet-library.mjs
       - destructuring: æ˜¯å¦éœ€è¦è§£æ„
       - npmrc: @dcp:registry=http://localhost:4873

    3. é…ç½® configure èŠ‚ç‚¹
       - è®¾ç½® loopã€conditionã€styles ç­‰åŸºç¡€é…ç½®é¡¹(é€šå¸¸éƒ½ä¸º true)
       - æ ¹æ®ç»„ä»¶ç‰¹æ€§è®¾ç½® isContainerã€isModalã€isPopper ç­‰å€¼
       - å®šä¹‰å¿«æ·å±æ€§(shortcuts.properties)ï¼Œé€‰æ‹© 3-5 ä¸ªæœ€é‡è¦çš„å±æ€§

    # ç¬¬äºŒæ­¥ï¼šprops å±æ€§åˆ†æ

    1. éå†ç»„ä»¶çš„æ‰€æœ‰ props å®šä¹‰

       - æå–æ¯ä¸ª prop çš„åç§°ã€ç±»å‹ã€é»˜è®¤å€¼å’ŒéªŒè¯è§„åˆ™
       - è¯†åˆ« prop æ˜¯å¦å…·æœ‰ required å±æ€§
       - åˆ†æ prop çš„ç”¨é€”(æ ¹æ®åç§°å’Œç»„ä»¶é€»è¾‘)

    2. å±æ€§åˆ†ç±»

       - å°†å±æ€§æŒ‰åŠŸèƒ½åˆ†ç»„ï¼šåŸºç¡€å±æ€§ã€æ ·å¼å±æ€§ã€é«˜çº§å±æ€§ç­‰
       - ä¸ºæ¯ä¸ªåˆ†ç»„åˆ›å»ºåˆé€‚çš„ä¸­æ–‡æ ‡ç­¾å’Œæè¿°

    3. è¯¦ç»†å±æ€§æ˜ å°„
       å¯¹æ¯ä¸ªå±æ€§ç”Ÿæˆè§„èŒƒçš„ schema æè¿°:
       - property: å±æ€§å
       - label: ä¸­æ–‡æ˜¾ç¤ºåç§°
       - description: è¯¦ç»†åŠŸèƒ½æè¿°
       - type: æ•°æ®ç±»å‹(string, number, boolean, object ç­‰)
       - defaultValue: é»˜è®¤å€¼
       - widget: åŸºäºå±æ€§ç±»å‹é€‰æ‹©é€‚å½“çš„ç»„ä»¶
         - å­—ç¬¦ä¸²ç±»å‹ â†’ InputConfigurator
         - æ•°å­—ç±»å‹ â†’ NumberConfigurator (æ·»åŠ  min/max/step å‚æ•°)
         - å¸ƒå°”ç±»å‹ â†’ SwitchConfigurator
         - é¢œè‰²å€¼ â†’ ColorConfigurator
         - ä¸‹æ‹‰é€‰é¡¹ â†’ SelectConfigurator
         - å¤æ‚å¯¹è±¡/æ•°ç»„ â†’ CodeConfigurator (JSON ç¼–è¾‘å™¨)

    # ç¬¬ä¸‰æ­¥ï¼šäº‹ä»¶åˆ†æ

    1. è¯†åˆ«ç»„ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶(emit)è°ƒç”¨

       - æå–äº‹ä»¶åç§°ã€å‚æ•°ä¿¡æ¯
       - åˆ†æäº‹ä»¶è§¦å‘æ¡ä»¶å’Œä¸Šä¸‹æ–‡

    2. ä¸ºæ¯ä¸ªäº‹ä»¶åˆ›å»ºè§„èŒƒçš„äº‹ä»¶æè¿°
       - ç”Ÿæˆäº‹ä»¶åç§°(é€šå¸¸ä»¥"on"å¼€å¤´ï¼Œå¦‚ onClick)
       - åˆ›å»ºä¸­æ–‡æ ‡ç­¾å’Œæè¿°
       - å®šä¹‰ functionInfoï¼ŒåŒ…æ‹¬ params(å‚æ•°å®šä¹‰)å’Œ returns

    # ç¬¬å››æ­¥ï¼šæ’æ§½åˆ†æ(å¦‚æœæœ‰)

    1. è¯†åˆ«ç»„ä»¶æ¨¡æ¿ä¸­çš„<slot>æ ‡ç­¾

       - è®°å½•æ’æ§½åç§°ã€é»˜è®¤å†…å®¹å’Œä½¿ç”¨åœºæ™¯
       - ç¡®å®šæ˜¯å¦ä¸ºå…·åæ’æ§½ã€ä½œç”¨åŸŸæ’æ§½

    2. åœ¨ schema ä¸­æ·»åŠ å¯¹åº”çš„æ’æ§½é…ç½®(å¦‚éœ€è¦)

    # ç¬¬äº”æ­¥ï¼šsnippets ç¤ºä¾‹ä»£ç ç”Ÿæˆ

    1. åˆ›å»ºå¤šä¸ªæœ‰ä»£è¡¨æ€§çš„ä½¿ç”¨ç¤ºä¾‹

       - é»˜è®¤é…ç½®ç¤ºä¾‹
       - ä¸åŒåŠŸèƒ½ç»„åˆçš„å…¸å‹ç¤ºä¾‹(2-3 ä¸ª)
       - ç‰¹æ®Šåœºæ™¯ç¤ºä¾‹(å¦‚æœ‰)

    2. ä¸ºæ¯ä¸ªç¤ºä¾‹å®šä¹‰:
       - name: ä¸­æ–‡åç§°
       - icon: å›¾æ ‡
       - snippetName: ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦
       - schema.props: è®¾ç½®å±æ€§å€¼

    # ç¬¬å…­æ­¥ï¼šæ ¡éªŒä¸ä¼˜åŒ–

    1. ç¡®ä¿ç”Ÿæˆçš„ schema ç¬¦åˆ OpenTiny åè®®è§„èŒƒ

       - æ£€æŸ¥å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´
       - éªŒè¯ç»“æ„æ˜¯å¦ç¬¦åˆè§„èŒƒè¦æ±‚

    2. å¯¹å±æ€§åˆ†ç»„è¿›è¡Œä¼˜åŒ–

       - ç¡®ä¿åˆ†ç»„é€»è¾‘æ¸…æ™°
       - å±æ€§é…ç½®ç¬¦åˆç”¨æˆ·ä¹ æƒ¯

    3. å®Œå–„æè¿°æ–‡æœ¬
       - ç¡®ä¿æè¿°å‡†ç¡®è¡¨è¾¾å±æ€§åŠŸèƒ½
       - æ·»åŠ ä½¿ç”¨æç¤ºå’Œæœ€ä½³å®è·µå»ºè®®

    # ç¬¬ä¸ƒæ­¥ï¼šæœ€ç»ˆè¾“å‡º

    ç”Ÿæˆå®Œæ•´çš„ JSON ç»“æ„ï¼ŒåŒ…å«:

    - id å’Œ version ä¿¡æ¯
    - nameã€component å’Œæè¿°ä¿¡æ¯
    - npm é…ç½®
    - group/category åˆ†ç±»
    - configure é…ç½®
    - schema å®šä¹‰(properties å’Œ events)
    - snippets ç¤ºä¾‹ä»£ç 

    # æ ¡éªŒ

    ä¸ç°æœ‰çš„å…¶ä»–ç»„ä»¶ schema æ¯”å¯¹ï¼Œæ ¡éªŒç”Ÿæˆçš„ schema æ•°æ®ç»“æ„ä¸€è‡´ï¼Œé…ç½®å®Œæ•´åº¦ï¼Œå¦‚æœå‘ç°ä¸ä¸€è‡´ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´

    # è¾“å‡º

    å°†ç”Ÿæˆçš„ schema æ–‡ä»¶è¾“å‡ºåˆ° componentSchema ç›®å½•ä¸‹

## å…³äº OpenTiny

æ¬¢è¿åŠ å…¥ OpenTiny å¼€æºç¤¾åŒºã€‚æ·»åŠ å¾®ä¿¡å°åŠ©æ‰‹ï¼šopentiny-official ä¸€èµ·å‚ä¸äº¤æµå‰ç«¯æŠ€æœ¯ï½\
OpenTiny å®˜ç½‘ï¼š**<https://opentiny.design>**\
OpenTiny ä»£ç ä»“åº“ï¼š**<https://github.com/opentiny>**\
TinyVue æºç ï¼š**<https://github.com/opentiny/tiny-vue>**\
TinyEngine æºç ï¼šâ€…**<https://github.com/opentiny/tiny-engine>**\
æ¬¢è¿è¿›å…¥ä»£ç ä»“åº“ StarğŸŒŸTinyEngineã€TinyVueã€TinyNGã€TinyCLIã€TinyEditor\~ å¦‚æœä½ ä¹Ÿæƒ³è¦å…±å»ºï¼Œå¯ä»¥è¿›å…¥ä»£ç ä»“åº“ï¼Œæ‰¾åˆ° good first issue æ ‡ç­¾ï¼Œä¸€èµ·å‚ä¸å¼€æºè´¡çŒ®\~

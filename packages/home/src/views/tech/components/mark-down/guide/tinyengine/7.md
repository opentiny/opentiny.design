æœ¬æ–‡ç”±ä½“éªŒæŠ€æœ¯å›¢é˜Ÿ TinyEngine é¡¹ç›®ç»„æˆå‘˜åˆ›ä½œ~

åœ¨ TinyEngine å¼€æºåï¼Œå¯¹ç§æœ‰åŒ–éƒ¨ç½²å­˜åœ¨è¯‰æ±‚çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œè€Œå½“å‰ TinyEngine å¤šé¡¹å†…å®¹éƒ½ä¾æ‰˜åœ¨å…¬ç½‘ä¸­ï¼Œå½“å‰å®˜ç½‘æä¾›çš„åŒºå—å‘å¸ƒæ–¹æ¡ˆï¼Œä¸ºå…¬ç½‘ç¯å¢ƒä¸‹çš„å‘å¸ƒï¼Œä¸èƒ½å®Œå…¨æ»¡è¶³éƒ¨åˆ†ç”¨æˆ·çš„éœ€æ±‚ã€‚å› æ­¤éœ€è¦æä¾›ç”¨æˆ·èƒ½å¤Ÿåœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ TinyEngine çš„å…¨éƒ¨åŠŸèƒ½çš„æ–¹æ¡ˆã€‚

ç°åœ¨æå‡ºåŒºå—å‘å¸ƒç§æœ‰åŒ–çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆç»™ç”¨æˆ·è‡ªè¡Œé€‰æ‹©ï¼š

- å°†åŒºå—å‘å¸ƒåˆ° npm ç§ä»“ä¸­ï¼Œæ­å»ºå†…éƒ¨çš„ unpkg å’Œç§ä»“ç¯å¢ƒ
- å°†åŒºå—å‘å¸ƒåˆ°æ•°æ®åº“ä¸­ï¼Œä»åº“ä¸­ç›´æ¥è¯»å–åŒºå—äº§ç‰©ã€‚

> **æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼**ï¼Œå› ä¸ºé‡‡ç”¨ç§ä»“çš„æ–¹å¼èƒ½å°½å¯èƒ½ä¿ç•™æˆ‘ä»¬å½“å‰çš„æ¨¡å¼ï¼Œä»¥åŠèƒ½å¤Ÿä½¿ç”¨åŒºå—ç‰ˆæœ¬æµ®åŠ¨åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬åŸºç¡€ç‰©æ–™ç»„ä»¶åº“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°†ç»„ä»¶åº“ä¸Šä¼ åˆ°ç§ä»“é‡Œï¼Œè¾¾åˆ°åŸºç¡€ç‰©æ–™çš„ç§æœ‰åŒ–ã€‚

æ³¨ï¼š

- æ­å»º unpkgï¼šåŸºäºå¼€æº unpkgï¼ˆ<https://github.com/mjackson/unpkg>ï¼‰ï¼Œ åœ¨å…¬å¸å†…éƒ¨æ­å»º npm çš„ cdn ç¯å¢ƒ
- ç§ä»“ç¯å¢ƒï¼šåœ¨å…¬å¸å†…éƒ¨æ­å»ºä¸€ä¸ªç§æœ‰çš„ npm registryï¼Œæä¾›å‘å¸ƒå’Œæ‹‰å–èƒ½åŠ›ã€‚

## **æ–¹æ¡ˆä¸€**

**å°†åŒºå—å‘å¸ƒåˆ° npm ç§ä»“ä¸­**
![å›¾ç‰‡](../../image/guide-tinyengine/7-1.png)

### **ä¸€ã€å®‰è£… verdaccio**

å½“å‰ä¸šç•Œå†…å­˜åœ¨å¾ˆå¤šæ­å»º npm ç§ä»“çš„æ–¹æ¡ˆï¼Œå¦‚: verdaccio, neuxs, cnpmjs ç­‰ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚åœ¨æ­¤ä»¥ä½¿ç”¨ verdaccio ä¸ºä¾‹ï¼Œå¯ä»¥æŸ¥çœ‹ verdaccio å®˜ç½‘æ–‡æ¡£æˆ–è€…ç›¸å…³å­¦ä¹ æ–‡æ¡£æ¥å®‰è£…ä½¿ç”¨ verdaccio ï¼Œåœ¨è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚

#### **1.1 verdaccio å®‰è£…**

æœ¬åœ°ç›´æ¥é€šè¿‡ npm ä¸‹è½½

```
npmÂ installÂ verdaccio
```

æœ¬åœ°å¯åŠ¨

```
verdaccio
```

æˆ–è€…ä½¿ç”¨ pm2 å¯åŠ¨

```
#Â å¯åŠ¨ verdaccio
pm2Â startÂ ./verdaccio
#Â æŸ¥çœ‹è¿›ç¨‹
pm2Â logÂ verdaccioÂ 
```

è™šæ‹Ÿæœºå¯ä»¥é€šè¿‡ docker æ‹‰å–é•œåƒ

```js
dockerÂ pullÂ verdaccio/verdaccio
```

å¯åŠ¨

```js
dockerÂ runÂ -itÂ Â -pÂ 4873:4873Â verdaccio/verdaccio
```

ï¼ˆçº¿ä¸Šä½¿ç”¨è¯·é…ç½®æ•°æ®æŒä¹…ä¿å­˜ï¼Œä»¥å…æ•°æ®ä¸¢å¤±ã€‚ï¼‰

#### **1.2 æ³¨å†Œç”¨æˆ·**

```js
npmÂ loginÂ --registry=http://localhost:4873/
```

#### **1.3 åˆ›å»º tokenï¼Œæ­¤ token æ›¿æ¢åŸ npm ä¸Šç”³è¯·çš„ tokenï¼Œç”¨äºå‘åŒ…**

```js
npmÂ tokenÂ createÂ --registry=http://localhost:4873/
```

token ç”Ÿæˆå®Œåï¼Œéœ€è¦é…ç½®åˆ°ç¯å¢ƒå˜é‡`NPM_AUTH_TOKEN`ä¸­ï¼Œåç»­ webService ä¼šä½¿ç”¨ï¼›æœ¬åœ°è¿è¡Œæ—¶çš„é…ç½®ï¼š

`vi ~/.bashrc`

```js
exportÂ NPM_AUTH_TOKEN=xxxxÂ Â #Â å¡«å…¥åˆšç”Ÿæˆçš„token
```

è®¾ç½®å®Œåï¼Œé‡æ–°æ‰“å¼€å‘½ä»¤è¡Œæˆ–åœ¨å½“å‰å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®©è®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚(git bash ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡æ— æ³•é€‚ç”¨äº powershell å’Œ cmd )

`source ~/.bashrc`

#### **1.4 å®‰è£…åéªŒè¯**

åœ¨å®‰è£…å¹¶å®Œæˆæµ‹è¯•åï¼Œ è®¿é—® Â <http://localhost:4873/>Â ï¼Œåœ¨ verdaccio çš„ç®¡ç†ç•Œé¢èƒ½çœ‹åˆ°å‘å¸ƒä¸Šå»çš„ npm åŒ…è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚

å»ºè®®å‘å¸ƒçš„æµ‹è¯•åŒ…åç§°æ ¼å¼ï¼š@å…¬å¸ç /ç»„ä»¶åï¼Œä»¥ä¾¿äºåç»­æ­å»º unpkg æ—¶æµ‹è¯•ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯æµ‹è¯•ç”¨çš„ package.json ä¾›å‚è€ƒï¼š

![å›¾ç‰‡](../../image/guide-tinyengine/7-2.png)

![å›¾ç‰‡](../../image/guide-tinyengine/7-3.png)

å‘å¸ƒå®Œæˆåï¼Œ è®¿é—® Â <http://localhost:4873/>Â ï¼Œåœ¨ verdaccio çš„ç®¡ç†ç•Œé¢èƒ½çœ‹åˆ°å‘å¸ƒä¸Šå»çš„ npm åŒ…è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/7-4.png)

### **äºŒã€å®‰è£… unpkg**

åœ¨ verdaccio å®‰è£…å¥½åï¼ŒTinyEngine çš„åŒ…å·²ç»èƒ½å¤Ÿæ­£å¸¸å‘å¸ƒåœ¨ç§ä»“ä¸Šï¼Œå¦‚æœæƒ³è¦åœ¨ TinyEngine çš„é¡µé¢ä¸Šå»è·å–åˆ°ç§ä»“é‡Œçš„åŒ…ï¼Œæ­£ç¡®çš„æ˜¾ç¤ºåŒºå—ï¼Œè¿™é‡Œè¿˜éœ€è¦å€ŸåŠ© unpkg å»è·å–åˆ°åŒ…çš„æ•°æ®ï¼Œè€Œç”±äºå…¬ç½‘çš„ unpkg æ— æ³•ç›´æ¥è¯»å– npm ç§ä»“é‡Œçš„åŒ…ï¼Œå› æ­¤è¿˜éœ€è¦æ­å»ºè‡ªå·±çš„ unpkg æœåŠ¡å™¨ï¼Œç»“åˆç§æœ‰çš„ unpkgï¼Œæ‰èƒ½åœ¨ TinyEngine çš„é¡µé¢ä¸Šæ˜¾ç¤ºä½ æ‰€å»ºçš„åŒºå—ã€‚

unpkg çš„æ­å»ºï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œåœ¨ç½‘ä¸Šå‚è€ƒç›¸å…³æ–‡æ¡£ï¼Œå°†å®˜æ–¹çš„ unpkg æºç ä¸‹è½½ä¸‹æ¥ï¼Œè¿›è¡Œæ”¹é€ ï¼Œä¹Ÿå¯ä»¥å‚è€ƒåˆ«äººçš„æˆåŠŸæ¡ˆä¾‹ã€‚æ”¹é€ æˆåŠŸåï¼Œè®¿é—® Â <http://localhost:8080/>Â  èƒ½çœ‹åˆ° unpkg æœåŠ¡å¯åŠ¨æˆåŠŸã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/7-5.png)

ç„¶åè®¿é—®ä¹‹å‰å‘å¸ƒçš„æµ‹è¯•åŒ…ï¼šÂ `http://localhost:8080/@å…¬å¸ç /ç»„ä»¶å`Â ï¼Œå¦‚èƒ½æ˜¾ç¤º js æ–‡ä»¶å†…å®¹, åˆ™è¡¨ç¤º unpkg å®‰è£…æˆåŠŸã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/7-6.png)

### **ä¸‰ã€ä¿®æ”¹ tiny-engine-webservice**

#### **3.1 ä¿®æ”¹ app/service/material-center/blockBuilder.ts çš„ ä»£ç **

```js
publicÂ unpkgBaseUrlÂ =Â 'http://localhost:8080';Â //Â ä¿®æ”¹ä¸ºunpkgæœåŠ¡çš„ipç«¯å£
```

```js
generatePackageJson(blockInfo,Â version)Â {
Â Â Â Â Â Â Â Â letÂ {Â label,Â idÂ }Â =Â blockInfo
Â Â Â Â Â Â Â Â labelÂ =Â label.replace(/\W|_/g,Â '').toLocaleLowerCase()Â ||Â 'default'
Â Â Â Â Â Â Â Â constÂ nameÂ =Â `@opentiny-assets/tinyengine-block-${label}-${id}`Â //Â ä¿®æ”¹ç‚¹ï¼šå‘åŒ…çš„åç§°æ ¹æ®è‡ªå·±æƒ…å†µæ›´æ”¹, @opentiny-assetsæ”¹æˆÂ @ç”¨æˆ·çš„å…¬å¸ç 
Â Â Â Â Â Â Â Â this.pkgNameÂ =Â name
Â Â Â Â Â Â Â Â returnÂ {
Â Â Â Â Â Â Â Â name,
Â Â Â Â Â Â Â Â version,
Â Â Â Â Â Â Â Â description:Â '',
Â Â Â Â Â Â Â Â main:Â `js/web-component.es.js`,Â Â //Â ä¿®æ”¹ç‚¹ï¼šmain å¿…é¡»æ˜¯ js/web-component.es.js , å¦åˆ™ unpkg æ— æ³•è¯»å–åˆ° js æ–‡ä»¶
Â Â Â Â Â Â Â Â keywords:Â [],
Â Â Â Â Â Â Â Â author:Â '',
Â Â Â Â Â Â Â Â license:Â 'ISC'
Â Â Â Â Â Â Â Â }
Â Â Â Â }
```

#### **3.2 ä¿®æ”¹ config.default.ts çš„ä»£ç **

æ›¿æ¢ registry ä¸ºè‡ªå·±çš„ç§ä»“åœ°å€

```js
config.registry = 'http://127.0.0.1:4873/' //Â ä¿®æ”¹ç‚¹ï¼šæ›¿æ¢ä¸ºè‡ªå·±çš„ç§ä»“åœ°å€
```

![å›¾ç‰‡](../../image/guide-tinyengine/7-7.png)

**æ³¨æ„ï¼š**Â  åœ¨ 1.3 å°èŠ‚é‡Œï¼Œå·²ç»ç”Ÿæˆäº† npm tokenï¼Œå†™å…¥åˆ°äº†`NPM_AUTH_TOKEN`ç¯å¢ƒå˜é‡ã€‚å› æ­¤æœ¬æ–‡ä»¶ä¸­`authToken`çš„èµ‹å€¼å°±ä¸ç”¨å†ä¿®æ”¹äº†ï¼Œè‹¥æ˜¯æ²¡æœ‰æ›´æ¢çš„è¯ï¼Œè®°å¾—å‚è€ƒ 1.3 å°èŠ‚ï¼Œå»æ›¿æ¢ä½ çš„ç¯å¢ƒå˜é‡ã€‚

#### **3.3 ä¿®æ”¹ app/service/cnpm.ts çš„ä»£ç **

å»æ‰ Â `--access=public`

```js
Â Â asyncÂ publishCnpm(packagePath)Â {
Â Â Â Â constÂ commandsÂ =Â ['npmÂ publish'];Â //Â ä¿®æ”¹ç‚¹ï¼šå»æ‰åŸå…ˆçš„--access=public
Â Â Â Â returnÂ this.ctx.helper.execCommandWithCatch(commands,Â {Â cwd:Â packagePathÂ },Â 'publishÂ cnpm');
Â Â }
```

### **å››ã€åœ¨ TinyEngine ä¸­å‘å¸ƒåŒºå—**

ä»¥ä¸Šæ­¥éª¤å®Œæˆåï¼Œå¯ä»¥å¯åŠ¨ tiny-engine è¿›è¡ŒåŒºå—å‘å¸ƒæµ‹è¯•ã€‚éªŒè¯è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡æŸ¥çœ‹ Â  tiny-engine-webservice çš„å‘å¸ƒè¿‡ç¨‹æ’æŸ¥é—®é¢˜ï¼ŒTinyEngine ä¼šç”Ÿæˆç»„ä»¶åŒ…:

![å›¾ç‰‡](../../image/guide-tinyengine/7-8.png)

ç„¶åå‘å¸ƒåˆ°ç§ä»“:

![å›¾ç‰‡](../../image/guide-tinyengine/7-9.png)

å‘å¸ƒå®Œæˆä¹‹åï¼Œå¯ä»¥æ‰“å¼€ Â <http://localhost:4873/>Â  éªŒè¯æ˜¯å¦å‘å¸ƒæˆåŠŸ

![å›¾ç‰‡](../../image/guide-tinyengine/7-10.png)

å¹¶ä¸”æŸ¥çœ‹æœ¬åœ°å¯åŠ¨çš„ unpkgï¼Œæ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®åˆšæ‰å‘å¸ƒçš„åŒºå—ã€‚

![å›¾ç‰‡](../../image/guide-tinyengine/7-11.png)

éªŒè¯å®Œæˆåï¼Œå¯ä»¥åœ¨ç‰©æ–™ä¸­æŠŠåˆšæ‰å‘å¸ƒçš„åŒºå—è¿›è¡Œæ·»åŠ ï¼Œæ·»åŠ å®Œæ¯•åå°±å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨åŒºå—åŠŸèƒ½ã€‚

### **äº”ã€æœåŠ¡éƒ¨ç½²**

å½“å‰æ­¥éª¤éƒ½æ˜¯åœ¨ç”µè„‘æœ¬åœ°ç¯å¢ƒä¸‹è¿è¡Œè°ƒè¯•çš„ï¼Œåœ¨æœ¬åœ°éªŒè¯æ­£ç¡®åï¼Œå¯ä»¥è‡ªè¡Œéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­ã€‚å®é™…ç”Ÿäº§éƒ¨ç½²æ¨¡å¼ä»¥ä¼ä¸šã€ç»„ç»‡å†…éƒ¨å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå…·ä½“å®‰è£…ä»¥åŠå¯åŠ¨æ“ä½œæµç¨‹éƒ½è·Ÿæœ¬åœ°ä¸€è‡´ï¼Œå¯èƒ½ä¼šæœ‰å®‰è£…ç›®å½•ä½ç½®çš„å·®å¼‚ã€‚

## **æ–¹æ¡ˆäºŒ**

**å°†åŒºå—å‘å¸ƒåˆ°æ•°æ®åº“**

### **ä¸€ã€æ–¹æ¡ˆç›®çš„**

åŸæœ‰çš„åŒºå—æ‰˜ç®¡äº npmï¼Œé€šè¿‡ cdn è·å–å·²å‘å¸ƒåŒºå—å†…çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å…¬ç½‘ç¯å¢ƒï¼Œä¸”ä¸ä½¿ç”¨ç§ä»“çš„æƒ…å†µä¸‹ï¼Œä¸ºåŒºå—çš„æ‰˜ç®¡æä¾›æ•°æ®åº“æ‰˜ç®¡æ–¹æ¡ˆï¼Œä½¿å¾—åŒºå—çš„ä½¿ç”¨ä¸åœ¨ä¾èµ–äºå…¬ç½‘ç¯å¢ƒå’Œ cdn

### **äºŒã€è®¾è®¡æ€è·¯**

- å°†åŸæœ‰çš„åŒºå—å‘å¸ƒä¿®æ”¹æˆæŠŠåŒºå—æ„å»ºäº§ç‰©è½¬æˆäºŒè¿›åˆ¶æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“
- åç«¯ç”Ÿæˆæ„å»ºäº§ç‰©é“¾æ¥ï¼Œæ›¿æ¢åŸæœ‰åŒºå—å‘å¸ƒåæ‰˜ç®¡åœ¨ unpkg çš„è¿æ¥ï¼Œæ ¼å¼ä¸ºï¼š<http://localhost:7011/material-center/api/block/read/@opentiny-assets/tinyengine-dev-block-testceshi11-2328@1.0.17/js/web-components.umd.js>
- æä¾›é“¾æ¥è®¿é—®è·å–æ–‡ä»¶çš„åç«¯æ–¹æ³•

### **ä¸‰ã€ç®€å• demoï¼Œä»…ä¾›å‚è€ƒ**

#### **1. æ–°å¢å­˜å‚¨æ•°æ®åº“çš„è¡¨ï¼Œå­—æ®µå¦‚ä¸‹ï¼š**

| **id**       | **int(10)**  | **è‡ªå¢ id** |
| ------------ | ------------ | ----------- |
| file_name    | varchar(255) | æ–‡ä»¶å      |
| package_name | varchar(255) | åŒ…å        |
| file_content | longtext     | æ–‡ä»¶å†…å®¹    |
| version      | varchar(255) | ç‰ˆæœ¬        |
| created_at   | timestamp    | åˆ›å»ºæ—¶é—´    |
| updated_at   | timestamp    | æ›´æ–°æ—¶é—´    |

strapi ç”Ÿæˆè¡¨å¯ä»¥åœ¨ç®¡ç†é¢æ¿åˆ›å»ºï¼Œä¹Ÿå¯ä»¥åœ¨ tiny-engine-data-center æœåŠ¡æ ¹ç›®å½• api æ–‡ä»¶å¤¹ä¸‹è‡ªå·±ç¼–è¾‘ä»£ç ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨ mysql åˆ›å»ºè¡¨

```js
Â Â {
Â Â "kind":Â "collectionType",
Â Â "collectionName":Â "block_file_store",
Â Â "info":Â {
Â Â Â Â "name":Â "block-file-store",
Â Â Â Â "description":Â ""
Â Â },
Â Â "options":Â {
Â Â Â Â "increments":Â true,
Â Â Â Â "timestamps":Â true
Â Â },
Â Â "attributes":Â {
Â Â Â Â "package_name":Â {
Â Â Â Â Â Â "type":Â "string",
Â Â Â Â Â Â "required":Â true
Â Â Â Â },
Â Â Â Â "file_name":Â {
Â Â Â Â Â Â "type":Â "string",
Â Â Â Â Â Â "required":Â true
Â Â Â Â },
Â Â Â Â "version":Â {
Â Â Â Â Â Â "type":Â "string",
Â Â Â Â Â Â "required":Â true
Â Â Â Â },
Â Â Â Â "file_content":Â {
Â Â Â Â Â Â "type":Â "text",
Â Â Â Â Â Â "required":Â true
Â Â Â Â }
Â Â }
}
```

#### **2. ä¿®æ”¹å‘å¸ƒæ–¹æ³•**

config.default.ts æ–‡ä»¶ä¸­æ–°å¢é…ç½®

```js
config.dataBaseUrl = 'http://localhost:7011/material-center/api/block/read'
```

å‘å¸ƒæ¥å£åœ¨æ–‡ä»¶å¤¹è·¯å¾„`/tiny-engine-webservice/app/service/material-center/blockBuilder.ts`ä¸‹ï¼Œå®ç°å¦‚ä¸‹ï¼š

```js
privateÂ asyncÂ publish(folder,Â blockInfo,Â version):Â Promise<any>Â {
Â Â Â Â letÂ {Â label,Â idÂ }Â =Â blockInfo;
Â Â Â Â labelÂ =Â (labelÂ asÂ String).replace(/\W|_/g,Â '').toLocaleLowerCase()Â ||Â 'default';
Â Â Â Â constÂ envÂ =Â 'alpha';Â //Â è§†å…·ä½“æƒ…å†µè€Œå®šï¼Œå¯ä»¥ä»RUN_MODEç¯å¢ƒå˜é‡å–ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨
Â Â Â Â constÂ nameÂ =Â `@opentiny-assets/tinyengine-${env}-block-${label}-${id}`;
Â Â Â Â this.pkgNameÂ =Â name;
Â Â Â Â 
Â Â Â Â constÂ prefixÂ =Â `${this.config.dataBaseUrl}/${this.pkgName}@${version}`;
Â Â Â Â constÂ filesÂ =Â awaitÂ globPromise(`**/*.*`,Â {
Â Â Â Â Â Â cwd:Â folder
Â Â Â Â });
Â Â Â Â for(constÂ fileÂ ofÂ files){
Â Â Â Â Â Â constÂ fileContentÂ =Â awaitÂ fs.readFile(Â path.join(folder,Â file));
Â Â Â Â Â Â //Â æ–‡ä»¶è½¬äºŒè¿›åˆ¶
Â Â Â Â Â Â constÂ base64DataÂ =Â fileContent.toString('base64');
Â Â Â Â Â Â constÂ filenameÂ =Â file.substring(file.lastIndexOf('/')Â +Â 1);
Â Â Â Â Â Â //Â å­˜å‚¨æ•°æ®åº“
Â Â Â Â Â Â awaitÂ this.service.material.blockFilesStore.create({
Â Â Â Â Â Â Â Â package_name:Â name,
Â Â Â Â Â Â Â Â file_name:Â filename,
Â Â Â Â Â Â Â Â version:Â version,
Â Â Â Â Â Â Â Â file_content:Â base64Data
Â Â Â Â Â Â Â });
Â Â Â Â Â }
Â Â Â Â returnÂ this.filterFiles(files,Â prefix);
Â Â }
```

#### **3. æ–°å¢åç«¯è·å–åŒºå—äº§ç‰© api æ¥å£ï¼š**

##### **3.1 æ¥å£**

| **Method** | **URI**                         | **Description**          |
| ---------- | ------------------------------- | ------------------------ |
| GET        | material-center/api/block/read/ | æ ¹æ®åŒºå—é“¾æ¥ä¿¡æ¯è¯»å–æ–‡ä»¶ |

###### **3.1.1 è¯·æ±‚ request**

| **Name**     | **Mandatory** | **Type** | **position** | **Description** |
| ------------ | ------------- | -------- | ------------ | --------------- |
| file_name    | M             | string   | body         | æ–‡ä»¶å          |
| version      | M             | string   | body         | ç‰ˆæœ¬            |
| package_name | M             | string   | body         | åŒ…å            |

###### **3.1.2 å“åº” Response**

| **Name** | **Mandatory** | **Type** | **Description** |
| -------- | ------------- | -------- | --------------- |
| data     | O             | object   | å“åº”æ•°æ®å®ä½“    |

åœ¨ Â `router/materialCenter/base.ts`Â  æ–°å¢è·¯ç”±ï¼š

```js
//Â è·¯ç”±è·å–æ–‡ä»¶é“¾æ¥è¯»å–æ–‡ä»¶
subRouter.get('/block/read/*', controller.materialCenter.block.readFileContentLink)
```

#### **4ã€æ¥å£å®ç°**

```js
asyncÂ readFileContentLink(){
Â Â Â Â constÂ paramsÂ =Â this.ctx.params;
Â Â Â Â constÂ paramTempÂ =Â params[0];
Â Â Â Â constÂ filenameÂ =Â paramTemp.substring(paramTemp.lastIndexOf('/')Â +Â 1);
Â Â Â Â constÂ versionRegexÂ =Â /@([\d.]+)/;
Â Â Â Â constÂ versionÂ =Â paramTemp.match(versionRegex)?Â paramTemp.match(versionRegex)[1]:null;
Â Â Â Â constÂ package_nameÂ =Â '@'Â +Â paramTemp.split('@')[1];
Â Â Â Â constÂ paramTempsÂ =
Â Â Â Â {
Â Â Â Â Â Â file_name:Â filename,
Â Â Â Â Â Â version:Â version,
Â Â Â Â Â Â package_name:Â package_name

Â Â Â Â }
Â Â Â Â constÂ resÂ =Â awaitÂ this.service.materialCenter.blockFileStore.find(paramTemps);
Â Â Â Â this.ctx.typeÂ =Â 'text/javascript';
Â Â Â Â this.ctx.bodyÂ =Â Buffer.from(res.data[0]?.file_content,Â 'base64').toString('utf8');
Â Â }
```

åœ¨ data-center é‡Œ block-file-store/controller ä¸‹ block-file-store.js æ–°å¢æ ¹æ®æ–‡ä»¶åå’ŒåŒ…åæŸ¥è¯¢æœ€æ–°ä¸€æ¡çš„æœ€é«˜ç‰ˆæœ¬çš„æ–‡ä»¶ä¿¡æ¯çš„æ–¹æ³•ï¼š

```js
module.exports = {
  async find(ctx) {
    const { fileName, packageName } = ctx.request.query
    return strapi.services['block-file-store'].find({
      file_name: fileName,
      package_name: packageName,
      _sort: 'version:DESC',
      _limit: 1
    })
  }
}
```

#### **5ã€æ•ˆæœå±•ç¤º**

a.åç«¯ç”¨ postman è°ƒç”¨è®¿é—®æ–‡ä»¶é“¾æ¥æ•ˆæœå¦‚ä¸‹ï¼š

![å›¾ç‰‡](../../image/guide-tinyengine/7-12.png)

b.åœ¨ç¯å¢ƒä¸Šéƒ¨ç½²åï¼Œæ–°å»ºåŒºå—ï¼Œå¯¹åŒºå—è¿›è¡Œå‘å¸ƒåï¼Œå°†åŒºå—åŠ å…¥åœ¨ç‰©æ–™ä¸­ï¼Œåœ¨ç”»å¸ƒé‡Œä½¿ç”¨åŒºå—æ—¶ï¼Œä¼šæˆåŠŸè¿”å›`web-compnents.umd.js`æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸åˆšæ‰å‘å¸ƒçš„åŒºå—ç‰ˆæœ¬ã€åŒ…åä¸€è‡´ï¼Œèƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºåŒºå—å†…å®¹ã€‚

## **æ€»ç»“**

å½“å‰ä»‹ç»äº†ä¸¤ç§æ–¹æ¡ˆçš„å…·ä½“å®ç°æ–¹å¼

- ä½¿ç”¨æ–¹æ¡ˆä¸€å¯ä»¥æœ€å¤§çš„æé«˜åŒºå—å‘å¸ƒçš„çµæ´»æ€§ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬æµ®åŠ¨åŠŸèƒ½ï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯éœ€è¦æ­å»ºå±€åŸŸç½‘å†…çš„ç§ä»“æœåŠ¡å’Œ unpkg æœåŠ¡ï¼›
- ä½¿ç”¨æ–¹æ¡ˆäºŒæ•°æ®åº“å­˜æ‰˜ç®¡çš„æ–¹å¼çœ‹ä¼¼æ›´åŠ æ–¹ä¾¿ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆæ•°æ®åº“å­˜å‚¨çš„å†…å®¹è¿‡äºåºå¤§ã€‚

å¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€ç¬¦åˆè‡ªå·±åœºæ™¯éœ€æ±‚çš„æ–¹æ¡ˆï¼Œè‹¥æ˜¯æ‚¨æœ‰ä¸åŒçš„æƒ³æ³•æˆ–è€…å»ºè®®ï¼Œä¹Ÿæ¬¢è¿æ‚¨ä¸€èµ·å‚ä¸è®¨è®ºï¼Œåœ¨è¿™é‡Œ(<https://github.com/opentiny/tiny-engine/discussions>)ç•™ä¸‹æ‚¨å®è´µçš„æ€è·¯ã€‚

---

æ„Ÿè°¢å¤§å®¶å¯¹ TinyEngine ä½ä»£ç å¼•æ“çš„æ”¯æŒï¼Œæ„Ÿè°¢å¼€å‘è€…**æ¬§é˜³åŒå­¦**çš„å®æˆ˜ç»éªŒï¼ŒåŠ©åŠ› OpenTiny å…±åŒæ¢ç´¢æ›´ä¼˜è´¨çš„è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿå¸Œæœ›åç»­æœ‰æ›´å¤šå°ä¼™ä¼´ä¸€èµ·åŠ å…¥ OpenTiny çš„å¼€æºå…±å»ºï¼Œè®©æ›´å¤šå¼€å‘è€…å—ç›Š~

## **å…³äº OpenTiny**

![4.20.PNG](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5aa71d5c8bc04a22be17601e2faf9464~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2529&h=1191&s=2146983&e=png&b=d5dbef)

[OpenTiny](https://opentiny.design/) æ˜¯ä¸€å¥—ä¼ä¸šçº§ Web å‰ç«¯å¼€å‘è§£å†³æ–¹æ¡ˆï¼Œæä¾›è·¨ç«¯ã€è·¨æ¡†æ¶ã€è·¨ç‰ˆæœ¬çš„ Â [TinyVue ç»„ä»¶åº“](https://opentiny.design/tiny-vue/zh-CN/overview)ï¼ŒåŒ…å«åŸºäº Angular+TypeScript çš„ [TinyNG ç»„ä»¶åº“](https://opentiny.design/tiny-ng/overview)ï¼Œæ‹¥æœ‰çµæ´»æ‰©å±•çš„ä½ä»£ç å¼•æ“ [TinyEngine](https://opentiny.design/tiny-engine#/home)ï¼Œå…·å¤‡ä¸»é¢˜é…ç½®ç³»ç»Ÿ[TinyTheme](https://opentiny.design/designtheme/home) / ä¸­åå°æ¨¡æ¿[TinyPro](https://opentiny.design/pro/home)/ [TinyCLI](https://opentiny.design/tiny-cli/home)å‘½ä»¤è¡Œç­‰ä¸°å¯Œçš„æ•ˆç‡æå‡å·¥å…·ï¼Œå¯å¸®åŠ©å¼€å‘è€…é«˜æ•ˆå¼€å‘ Web åº”ç”¨ã€‚

---

æ¬¢è¿åŠ å…¥ [OpenTiny å¼€æºç¤¾åŒº](https://github.com/opentiny/)ã€‚æ·»åŠ å¾®ä¿¡å°åŠ©æ‰‹ï¼šopentiny-official ä¸€èµ·å‚ä¸äº¤æµå‰ç«¯æŠ€æœ¯ï½æ›´å¤šè§†é¢‘å†…å®¹ä¹Ÿå¯å…³æ³¨[B ç«™](https://space.bilibili.com/15284299?spm_id_from=333.1007.0.0)ã€æŠ–éŸ³ã€å°çº¢ä¹¦ã€è§†é¢‘å·\
OpenTinyÂ  ä¹Ÿåœ¨æŒç»­æ‹›å‹Ÿè´¡çŒ®è€…ï¼Œæ¬¢è¿ä¸€èµ·å…±å»º

[OpenTiny å®˜ç½‘](https://opentiny.design/)ï¼š**<https://opentiny.design/>**\
[OpenTiny ä»£ç ä»“åº“](https://github.com/opentiny/)ï¼š**<https://github.com/opentiny/>**\
[TinyVue æºç ](https://github.com/opentiny/tiny-vue)ï¼š**<https://github.com/opentiny/tiny-vue>**\
[TinyEngine æºç ](https://github.com/opentiny/tiny-engine)ï¼š **<https://github.com/opentiny/tiny-engine>**

æ¬¢è¿è¿›å…¥ä»£ç ä»“åº“ StarğŸŒŸ[TinyEngine](https://github.com/opentiny/tiny-engine)ã€[TinyVue](https://github.com/opentiny/tiny-vue)ã€[TinyNG](https://github.com/opentiny/ng)ã€[TinyCLI](https://github.com/opentiny/tiny-cli)\~
å¦‚æœä½ ä¹Ÿæƒ³è¦å…±å»ºï¼Œå¯ä»¥è¿›å…¥ä»£ç ä»“åº“ï¼Œæ‰¾åˆ° Â good first issue æ ‡ç­¾ï¼Œä¸€èµ·å‚ä¸å¼€æºè´¡çŒ®\~
